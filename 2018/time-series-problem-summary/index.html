<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="谷粒">
  <meta name="description" content="数据挖掘/机器学习工程师">
  <meta name="keywords" content="华中科技大学,谷粒,数据挖掘,网易游戏,用户分析,增长黑客,开发者,极客,代码,开源,Developer,Programmer,Coder,Geek,DataScientist">
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-76017508-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  <link rel="prev" href="https://kuhungio.me/2017/ssd/" />
  <link rel="next" href="https://kuhungio.me/2018/why-is-data-hard/" />
  <link rel="canonical" href="https://kuhungio.me/2018/time-series-problem-summary/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           时序小结 | time series problem summary 时间序列问题处理 | Kuhung&#39;s Blog
       
  </title>
  <meta name="title" content="时序小结 | time series problem summary 时间序列问题处理 | Kuhung&#39;s Blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https://kuhungio.me"
    },
    "articleSection" : "posts",
    "name" : "时序小结 | time series problem summary 时间序列问题处理",
    "headline" : "时序小结 | time series problem summary 时间序列问题处理",
    "description" : "Source https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting/discussion
总结一：保证数据同分布 验证集的选取，分布上应尽量靠近测试集。
 方式一:：对抗验证集的生成。 方式二： 就近选取相同天数。 方式三:：类比属性。如本赛题 &ldquo;golden week&rdquo; 与 &ldquo;new year&rdquo; 类比，选取 &ldquo;new year&rdquo; 段作为验证集。  tips: kfold 用在时间序列上不合适，会有数据泄露风险。正确的方法应是滑窗。
总结二：异常值特殊处理 一些特殊的时间节点（或者说是异常值），应该予以特殊考虑。比如本次比赛中的 &ldquo;golden week&rdquo;.。需要对其进行变换，而不是直接依靠模型的预测结果。
 方式一:：等同法   The rules:
Treat holiday as Saturday
If the day before holiday is weekday ,treat the day before holiday as Friday If the day after holiday is weekday ,treat the day after holiday as Monday it work not only golden week but also a lot other holidays.",
    "inLanguage" : "zh-CN",
    "author" : "谷粒",
    "creator" : "谷粒",
    "publisher": "谷粒",
    "accountablePerson" : "谷粒",
    "copyrightHolder" : "谷粒",
    "copyrightYear" : "2018",
    "datePublished": "2018-02-08 00:00:00 &#43;0000 UTC",
    "dateModified" : "2018-02-08 00:00:00 &#43;0000 UTC",
    "url" : "https://kuhungio.me/2018/time-series-problem-summary/",
    "wordCount" : "237",
    "keywords" : [ "时序问题", "Kuhung&#39;s Blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kuhungio.me">Kuhung&#39;s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="About">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://kuhungio.me">Kuhung&#39;s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="About">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">时序小结 | time series problem summary 时间序列问题处理</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://kuhungio.me" rel="author">谷粒</a> with ♥
                <span class="post-time">
                on <time datetime=2018-02-08 itemprop="datePublished">February 8, 2018</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://kuhungio.me/categories/%E9%A1%B9%E7%9B%AE%E5%B0%8F%E7%BB%93/"> 项目小结 </a>
                        
                </span>

                |
                <a href="#gitalk-container" itemprop="discussionUrl">
                    <span class="gitalk-comment-count" itemprop="commentCount"></span>
                </a>
                条评论
        </div>
    </header>

        <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title"></h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#总结一-保证数据同分布">总结一：保证数据同分布</a></li>
<li><a href="#总结二-异常值特殊处理">总结二：异常值特殊处理</a></li>
<li><a href="#总结三-特征构造靠倒推">总结三：特征构造靠倒推</a></li>
<li><a href="#总结四-独立建模">总结四：独立建模</a>
<ul>
<li><a href="#个人感想">个人感想</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

<script type="text/javascript">
  window.onload = function () {
    var fix = $('.post-toc');
    var end = $('.post-comment');
    var fixTop = fix.offset().top, fixHeight = fix.height();
    var endTop, miss;
    var offsetTop = fix[0].offsetTop;

    $(window).scroll(function () {
      var docTop = Math.max(document.body.scrollTop, document.documentElement.scrollTop);

      if (end.length > 0) {
        endTop = end.offset().top;
        miss = endTop - docTop - fixHeight;
      }

      if (fixTop < docTop) {
        fix.css({ 'position': 'fixed' });
        if ((end.length > 0) && (endTop < (docTop + fixHeight))) {
          fix.css({ top: miss });
        } else {
          fix.css({ top: 0 });
        }
      } else {
        fix.css({ 'position': 'absolute' });
        fix.css({ top: offsetTop });
      }
    })
  }
</script>

    <div class="post-content">
        

        

        
        

          
          
          

          
          
          

          

<p>Source <a href="https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting/discussion" rel="nofollow noreferrer" target="_blank">https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting/discussion</a></p>

<h3 id="总结一-保证数据同分布">总结一：保证数据同分布</h3>

<p>验证集的选取，分布上应尽量靠近测试集。</p>

<ul>
<li>方式一:：对抗验证集的生成。</li>
<li>方式二： 就近选取相同天数。</li>
<li>方式三:：类比属性。如本赛题 &ldquo;golden week&rdquo; 与 &ldquo;new year&rdquo; 类比，选取 &ldquo;new year&rdquo; 段作为验证集。</li>
</ul>

<p>tips: <strong>kfold 用在时间序列上不合适，会有数据泄露风险。正确的方法应是滑窗。</strong></p>

<h3 id="总结二-异常值特殊处理">总结二：异常值特殊处理</h3>

<p>一些特殊的时间节点（或者说是异常值），应该予以特殊考虑。比如本次比赛中的 &ldquo;golden week&rdquo;.。需要对其进行变换，而不是直接依靠模型的预测结果。</p>

<!-- more -->

<ul>
<li>方式一:：等同法</li>
</ul>

<blockquote>
<p>The rules:</p>

<p>Treat holiday as Saturday</p>

<p>If the day before holiday is weekday ,treat the day before holiday as Friday
If the day after holiday is weekday ,treat the day after holiday as Monday
it work not only golden week but also a lot other holidays.</p>

<p>So the trick is from careful EDA and CV rather than luck</p>
</blockquote>

<ul>
<li>方式二:：标记法</li>
</ul>

<blockquote>
<p>days-from-holiday or days-to-holiday
or
0/1 flags whether the previous/next day and second-to-last/next-but-one day is a holiday.</p>
</blockquote>

<pre><code class="language-Python">#Source https://github.com/MaxHalford/kaggle-recruit-restaurant/blob/master/Solution.ipynb

date_info = pd.read_csv('data/kaggle/date_info.csv')
date_info.rename(columns={'holiday_flg': 'is_holiday', 'calendar_date': 'visit_date'}, inplace=True)
date_info['prev_day_is_holiday'] = date_info['is_holiday'].shift().fillna(0)
date_info['next_day_is_holiday'] = date_info['is_holiday'].shift(-1).fillna(0)

date_info.head()
</code></pre>

<h3 id="总结三-特征构造靠倒推">总结三：特征构造靠倒推</h3>

<p>时间序列的特征生成，还是多靠 lagging 往前推的手法。</p>

<p>Source <a href="https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting/discussion/49174" rel="nofollow noreferrer" target="_blank">https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting/discussion/49174</a></p>

<blockquote>
<p>lagging visitors features 1-14 (by &lsquo;air_store_id&rsquo; and by dayOfWeek), lagging visitors features 1-14 (by &lsquo;air_store_id&rsquo; only), the lagging-difference visitors features 1-13, the lagging-difference-delta4 visitors features 1-10, WeightedMovingAverage for the lagging lagging visitors features, mean/median/min/max/(percentile10,30,70,90)/sum/count visitor stats features for past 14 days, 28 days, 60 days, 90 days, 120 days, 180 days, 364 days (by &lsquo;air_store_id&rsquo; and by dayOfWeek), mean/median/min/max/(percentile10,30,70,90)/sum/count visitor stats features for past 14 days, 28 days, 60 days, 90 days, 120 days, 180 days, 364 days (by &lsquo;air_store_id&rsquo; only).
or
mean weekly visitors up to lag 20 and for mean monthly visitors up to lag 8 or so&hellip;</p>
</blockquote>

<h3 id="总结四-独立建模">总结四：独立建模</h3>

<p>模型训练。时间序列问题，一般是预测未来一段时间的情况。针对总结三中的特征生成方法，为避免过拟合，宜采用每天分开建模的方法。原因在于：靠后的时间，其特征依赖前面的预测结果来生成。</p>

<hr />

<h4 id="个人感想">个人感想</h4>

<p>取得好效果，大多数时间靠的不是复杂的模型、不是复杂的CV方式，而是<strong>对数据的观察</strong>（如： holiday trick 加公开的 kernel， 就可以取得银牌的成绩）以及<strong>特征构造方面的实践</strong>。</p>

<p><strong>Top solutions are rather simple.</strong></p>

    </div>

    <div class="post-copyright">
            
            <p class="copyright-item">
                <span>Author:</span>
                <span>谷粒 </span>
                </p>
            

            
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://kuhungio.me/2018/time-series-problem-summary/>
                        <script>
                            document.write(decodeURI(location.origin + location.pathname))
                        </script>
                    </a>
            </p>
            
            
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>


    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s):
            
            <span class="tag"><a href="https://kuhungio.me/tags/%E6%97%B6%E5%BA%8F%E9%97%AE%E9%A2%98/">
                    #时序问题</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> ·
                <span><a href="https://kuhungio.me">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://kuhungio.me/2017/ssd/" class="prev" rel="prev" title="Single Shot MultiBox Detector Keras version"><i class="iconfont icon-left"></i>&nbsp;Single Shot MultiBox Detector Keras version</a>
        
        
        <a href="https://kuhungio.me/2018/why-is-data-hard/" class="next" rel="next" title="Why is Data Hard 为啥说做数据这行不容易">Why is Data Hard 为啥说做数据这行不容易&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>
</article>
          
<div class="post-comment"><div onclick="showDisqus();" id="disqus_title" class="disqus_title">显示 Disqus 评论</div><div id="gitalk-container" class="gitalk-container"></div>
    <link rel="stylesheet" href="/lib/gitalk/gitalk-1.2.2.min.css">
    <script src="/lib/gitalk/gitalk-1.2.2.min.js"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '41c8cc48b32480a5431b14adfc54104e',
        title: '时序小结 | time series problem summary 时间序列问题处理',
        clientID: '7e5b8bd7063e5315e349',
        clientSecret: 'd6bd237e0a078b7e343775a47533d7b95d364899',
        repo: 'kuhung.github.io',
        owner: 'kuhung',
        admin: ['kuhung'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the
      <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a>
    </noscript><div id="disqus_thread"></div>
    <script type="text/javascript">
    function showDisqus() {
      

      
      
      
      

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = false;
      var disqus_shortname = 'kuhungio';
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      window.location.hash = "#disqus_thread";
    }
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>

          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2016 - 2019</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i>
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://kuhungio.me">谷粒</a> | </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span>
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
